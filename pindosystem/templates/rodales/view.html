<!doctype html>

{% extends "../layout/base.html" %}

{% load static %}
{% load humanize %}
{% load i18n %}
{% load l10n %}

{% block sidebar %}

{% include "../element/sidebar.html" %}

{% endblock %}

{% block content %}

  {% block header %}

  {% include "../element/header.html" %}

  {% endblock %}

  <div class="page-wrapper">
  
    {% block main_content %}

    <div class="page-body" style="margin-top: unset; margin-bottom: unset;">
                
        <div class="container-xl" style="padding-left: 0px;">
          
            {% if messages %}

            {% include "../element/alert-sucess.html" %}
            {% endif %}

            <div class="row row-cards" style="margin-right: -15px;">
              <div class="col-xxl-12 col-md-12 col-lg-12 col-sm-12" style="padding-right: 0px;">
                <div class="card min-vh-95" id="gantt-container">
                    <div class="card-header">

                      <ul class="nav nav-tabs card-header-tabs bg-azure-lt" data-bs-toggle="tabs">
                        <li class="nav-item">
                          <a href="#tabs-map" class="nav-link active text-dark" data-bs-toggle="tab">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" 
                            stroke="#182433" fill="none" stroke-linecap="round" stroke-linejoin="round">
                              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                              <polyline points="5 12 3 12 12 3 21 12 19 12" />
                              <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
                              <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
                            </svg> Mapa
                          </a>
                        </li>
                        <li class="nav-item">
                          <a href="#tabs-costos" class="nav-link" data-bs-toggle="tab">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-currency-dollar" width="24" height="24" viewBox="0 0 24 24" 
                            stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                              <path d="M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2" /><path d="M12 3v3m0 12v3" /></svg> Costos
                          </a>
                        </li>
                        <li class="nav-item">
                          <a href="#tabs-planificacion" class="nav-link" data-bs-toggle="tab">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-event" width="24" height="24" 
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" />
                              <path d="M16 3l0 4" /><path d="M8 3l0 4" /><path d="M4 11l16 0" /><path d="M8 15h2v2h-2z" /></svg> Planificacion
                          </a>
                        </li>
                      </ul>
                    </div>

                    <div class="card-body" style="padding-right: 1px; padding-left: 1px; padding-top: 1px; padding-bottom: 0px;">
                      
                      <div class="tab-content">
                        <div class="tab-pane active show min-vh-95 max-vh-95" id="tabs-map" style="background-color: blueviolet;">

                           <div style="display: inherit; background-color: brown; width: 100%; height: 100vh; position:relative;">

                              <div id="map" style="width: 100%; height: 100%;"></div>
                        
                           </div>
                        </div>
                      

                        <div class="tab-pane" id="tabs-costos">
                          <h4>Intervenciones</h4>
                          <div>Donec ac vitae diam amet vel leo egestas consequat rhoncus in luctus amet, facilisi sit mauris accumsan nibh habitant senectus</div>
                        </div>

                        <div class="tab-pane min-vh-95 max-vh-95 pt-5 pl-5" id="tabs-planificacion">
                          <h1 class="text-center text-blue">Planificación de Intervenciones</h1>
                          <div style="display:flex; width: 100%; position:relative;" class="p-5" id="prueba">
                            <div style="max-height: 500px; overflow-x: auto !important; position: relative;" id="gantt"></div>
                          </div>

                          <div class="hr-text mt-6 mb-6">Detalle de Intervenciones</div>

                      

                          <div class="row" style="margin-right: unset; margin-left: unset;">
                              <div class="col-xxl-5 col-xl-5 col-md-5 col-sm-5 d-flex justify-content-around align-items-stretch flex-column-reverse">
                                <div class="card">
                                  <div class="card-body">
                                    <h3 class="card-title">Intervenciones (Total de Árboles extraídos)</h3>
                                    <table class="table table-sm table-borderless">
                                      <thead>
                                        <tr>
                                          <th>Tipo</th>
                                          <th class="text-end">Total</th>
                                          <th class="text-end">%</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                      

                                        {% for value in res_intervenciones %}
                                        {% if value.category == "plantacion"%}
                                        <tr>
                                        
                                          <td>
                                            <div class="progressbg">
                                              <div class="progress progressbg-progress">
                                                <div class="progress-bar bg-teal" style="width: 100%" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="100% Complete">
                                                  <span class="visually-hidden">100% Complete</span>
                                                </div>
                                              </div>
                                              <div class="progressbg-text text-white">Total de Árboles Plantados</div>
                                            </div>
                                          </td>
                                          {% language 'es-AR' %}
                                          <td class="w-1 fw-bold text-end">{{ value.value }}</td>
                                      
                                          <td class="w-1 fw-bold text-end">{{ value.porcentaje|floatformat:1 }}</td>
                                          {% endlanguage %}
                                        </tr>

                                        {% elif value.category == "disponible"%}

                                        <tr>
                                        
                                          <td>
                                            <div class="progressbg">
                                              <div class="progress progressbg-progress">
                                                <div class="progress-bar bg-teal" style="width: {{ value.porcentaje}}%" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="100% Complete">
                                                  <span class="visually-hidden">100% Complete</span>
                                                </div>
                                              </div>
                                              <div class="progressbg-text">{{value.name}}</div>
                                            </div>
                                          </td>
                                          {% language 'es-AR' %}
                                          <td class="w-1 fw-bold text-end">{{ value.value }}</td>
                                      
                                          <td class="w-1 fw-bold text-end">{{ value.porcentaje|floatformat:1 }}</td>
                                          {% endlanguage %}
                                        </tr>
                                        
                                        {% else %}
                                          <tr>
                                            <td>
                                              <div class="progressbg">
                                                <div class="progress progressbg-progress">

                                                  {% if value.category != "sobrevivencia"%}
                                                    <div class="progress-bar" style="width: {{value.porcentaje}}%; background-color: {{value.color}}; opacity: 0.5;" 
                                                    role="progressbar" aria-valuenow="76.29" 
                                                    aria-valuemin="0" aria-valuemax="100" aria-label="{{value.porcentaje}}% Complete">
                                                      <span class="visually-hidden">{{value.porcentaje}}% Complete</span>
                                                    </div>
                                                  {% else %}

                                                    <div class="progress-bar bg-gray900" style="width: {{value.porcentaje}}%; opacity: 0.5;" 
                                                    role="progressbar" aria-valuenow="76.29" 
                                                    aria-valuemin="0" aria-valuemax="100" aria-label="{{value.porcentaje}}% Complete">
                                                      <span class="visually-hidden">{{value.porcentaje}}% Complete</span>
                                                    </div>

                                                  {% endif %}
                                                </div>
                                                <div class="progressbg-text">{{value.name}}</div>
                                              </div>
                                            </td>
                                            {% language 'es-AR' %}
                                            <td class="w-1 text-end">{{ value.value }}</td>
                                        
                                            <td class="w-1 text-end">{{ value.porcentaje|floatformat:1}}</td>
                                            {% endlanguage %}
                                          </tr>
                                      
                                        {% endif %}

                                      

                                        {% endfor %}

                                      
                                      
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </div>

                              <div class="col-xxl-7 col-xl-7 col-md-7 col-sm-7">
                                <div class="d-flex justify-content-center align-items-center" style="max-height: 500px;">
                                  <canvas id="myChart"></canvas>

                                  <div id="error_graph" class="alert alert-important alert-danger alert-dismissible d-none" role="alert">
                                    <div class="d-flex">
                        
                                      <div>
                                        No se ha podido construir el gráfico debido a un error en los datos. Verifique sus datos y actualice la página.
                                      </div>
                                    </div>
                                    <a class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="close"></a>
                                  </div>
                                </div>

                              </div>
                          </div>

                          <hr class="hr" />

                          <div class="row mt-5" style="margin-right: unset; margin-left: unset;">
                            <div class="col-xxl-5 col-xl-5 col-md-5 col-sm-5 d-flex justify-content-around align-items-stretch flex-column-reverse">
                              <div class="card">
                                <div class="card-body">
                                  <h3 class="card-title">Intervenciones: Total de Superficies extraídas (ha)</h3>
                                  <table class="table table-sm table-borderless">
                                    <thead>
                                      <tr>
                                        <th>Tipo</th>
                                        <th class="text-end">Total (ha)</th>
                                        <th class="text-end">%</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                    

                                      {% for value in res_intervenciones %}
                                      {% if value.category == "plantacion"%}
                                      <tr>
                                      
                                        <td>
                                          <div class="progressbg">
                                            <div class="progress progressbg-progress">
                                              <div class="progress-bar bg-teal" style="width: 100%" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="100% Complete">
                                                <span class="visually-hidden">100% Complete</span>
                                              </div>
                                            </div>
                                            <div class="progressbg-text text-white">Superficie Total Plantada</div>
                                          </div>
                                        </td>
                                        {% language 'es-AR' %}
                                        <td class="w-1 fw-bold text-end">{{ value.superficie }}</td>
                                    
                                        <td class="w-1 fw-bold text-end">{{ value.porc_superficie|floatformat:1 }}</td>
                                        {% endlanguage %}
                                      </tr>

                                      {% elif value.category == "disponible"%}

                                      <tr>
                                      
                                        <td>
                                          <div class="progressbg">
                                            <div class="progress progressbg-progress">
                                              <div class="progress-bar bg-teal" style="width: {{ value.porc_superficie}}%" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="100% Complete">
                                                <span class="visually-hidden">100% Complete</span>
                                              </div>
                                            </div>
                                            <div class="progressbg-text">{{value.name}}</div>
                                          </div>
                                        </td>
                                        {% language 'es-AR' %}
                                        <td class="w-1 fw-bold text-end">{{ value.superficie }}</td>
                                    
                                        <td class="w-1 fw-bold text-end">{{ value.porc_superficie|floatformat:1 }}</td>
                                        {% endlanguage %}
                                      </tr>
                                      
                                      {% else %}
                                      {% if value.category != "sobrevivencia"%}
                                        <tr>
                                          <td>
                                            <div class="progressbg">
                                              <div class="progress progressbg-progress">

                                               
                                                  <div class="progress-bar" style="width: {{value.porc_superficie}}%; background-color: {{value.color}}; opacity: 0.5;" 
                                                  role="progressbar" aria-valuenow="76.29" 
                                                  aria-valuemin="0" aria-valuemax="100" aria-label="{{value.porc_superficie}}% Complete">
                                                    <span class="visually-hidden">{{value.porc_superficie}}% Complete</span>
                                                  </div>
                                        
                                               
                                              </div>
                                              <div class="progressbg-text">{{value.name}}</div>
                                            </div>
                                          </td>
                                          {% language 'es-AR' %}
                                          <td class="w-1 text-end">{{ value.superficie }}</td>
                                      
                                          <td class="w-1 text-end">{{ value.porc_superficie|floatformat:1}}</td>
                                          {% endlanguage %}
                                        </tr>
                                     {% endif %}
                                      {% endif %}

                                    

                                      {% endfor %}

                                    
                                    
                                    </tbody>
                                  </table>
                                </div>
                              </div>
                            </div>

                            <div class="col-xxl-7 col-xl-7 col-md-7 col-sm-7">
                              <div class="d-flex justify-content-center align-items-center" style="max-height: 500px;">
                                <canvas id="myChart2"></canvas>

                                <div id="error_graph" class="alert alert-important alert-danger alert-dismissible d-none" role="alert">
                                  <div class="d-flex">
                      
                                    <div>
                                      No se ha podido construir el gráfico debido a un error en los datos. Verifique sus datos y actualice la página.
                                    </div>
                                  </div>
                                  <a class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="close"></a>
                                </div>
                              </div>

                            </div>
                        </div>
                     


                       
                        </div>


                

                      </div>
                    </div>
                  </div>
                  
                 
                </div>
              </div>
            </div>

         
        </div>
      </div>

     
      <script src="{% static 'js/gantt/timelines-chart.min.js' %}"></script>
      <script src="{% static 'js/d3/d3.js' %}"></script>
      <script src="{% static 'js/planificacion/planificacion.js' %}"></script>
     


      
    {% endblock main_content %}

    <script>
        $(function () {
            $('#tabladata').DataTable({
                "paging": true,
                "lengthChange": false,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": false,
                "pageLength": 10,
                order: [[0, 'asc']],
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json',
                }
            });
        })

    </script>

    <script src="{% static 'js/gis/rodales_config/plantaciones_rodales_config.js' %}"></script>
    
    <script src="{% static 'js/chart/utils.js' %}"></script>
    <script src="{% static 'js/chart/chart.umd.js' %}"></script>



  

    <script>
      var map = new L.map('map');
      var layerControl = null;
      
      //controlo que no sean null
      let rodal_gis = JSON.parse("{{rodales_gis|escapejs}}");
      let plantaciones_ = JSON.parse("{{plantaciones_gis|escapejs}}");
      let sobrevivencia_gis = JSON.parse("{{sobrevivencia_gis|escapejs}}");
      let poda_gis = JSON.parse("{{poda_gis|escapejs}}");
      let raleo_gis = JSON.parse("{{raleo_gis|escapejs}}");

      var rodaldata = JSON.parse("{{rodaldata|escapejs}}");
     
      initGis(rodal_gis, plantaciones_);
      cerateInfoRodal(rodaldata);

      loadIntervenciones(sobrevivencia_gis, 'Sobrevivencia');
      loadIntervenciones(poda_gis, 'Poda');
      loadIntervenciones(raleo_gis, 'Raleo');
      
    </script>



    <script>

      let categorias_inter = JSON.parse("{{categorias_intervencion|escapejs}}");
      let eventos_planificacion = JSON.parse("{{eventos_planificacion|escapejs}}");
      let name_rodal =  '{{ name_rodal|escapejs }}';

      console.log(categorias_inter);
      console.log(eventos_planificacion);
      console.log(name_rodal);
      
      initGanttByRodal(categorias_inter, eventos_planificacion, name_rodal, 'gantt-container');


    </script>

  
  

    <script>

      try {
        let resumen_intervenciones = JSON.parse("{{resumen_intervenciones|escapejs}}");
        createChart(resumen_intervenciones, 'Intervenciones', 'myChart', 'pie', '% de Intervenciones');

        createChartSuperficie(resumen_intervenciones, 'Intervenciones', 'myChart2', 'doughnut', '% de Superficies');

      } catch(e){
        
        //manejo el error
        let alert_danger = document.getElementById('error_graph');
        alert_danger.classList.remove("d-none");

        let canvas = document.getElementById('myChart');
        canvas.remove();

      }

     
    </script>
    
  </div>

{% endblock  %}